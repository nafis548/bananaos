name: CI/CD Pipeline for Banana OS (Angular)

# ржХржЦржи ржПржЗ Workflow ржЯрж┐ ржЯрзНрж░рж┐ржЧрж╛рж░ рж╣ржмрзЗ
on:
  # ржпржЦржи main ржмрзНрж░рж╛ржЮрзНржЪрзЗ ржХрзЛржб push ржХрж░рж╛ рж╣ржмрзЗ
  push:
    branches:
      - main
  # ржорзНржпрж╛ржирзБржпрж╝рж╛рж▓рж┐ Workflow ржЪрж╛рж▓рж╛ржирзЛрж░ ржЕржкрж╢ржи
  workflow_dispatch:

jobs:
  build-and-deploy:
    # ржмрж┐рж▓рзНржбржЯрж┐ ржЪрж▓ржмрзЗ Ubuntu рж▓рзЗржЯрзЗрж╕рзНржЯ ржнрж╛рж░рзНрж╕ржирзЗ
    runs-on: ubuntu-latest

    steps:
      - name: ЁЯНМ Checkout Code
        # рж░рж┐ржкрзЛржЬрж┐ржЯрж░рж┐ ржерзЗржХрзЗ ржХрзЛржб ржбрж╛ржЙржирж▓рзЛржб ржХрж░рж╛
        uses: actions/checkout@v4
        
      - name: ЁЯЯв Setup Node.js
        # package.json ржерзЗржХрзЗ Node.js ржнрж╛рж░рзНрж╕ржи (v20) ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: ЁЯУж Install Dependencies
        # рж╕ржорж╕рзНржд ржкрзНржпрж╛ржХрзЗржЬ ржЗржирзНрж╕ржЯрж▓ ржХрж░рж╛
        run: npm install

      - name: ЁЯПЧя╕П Build Project with Base Path Fix
        # ржЕрзНржпрж╛ржЩрзНржЧрзБрж▓рж╛рж░ ржмрж┐рж▓рзНржб ржХржорж╛ржирзНржбржЯрж┐ ржЪрж╛рж▓рж╛ржирзЛ рж╣ржЪрзНржЫрзЗред
        # ржмрзНрж▓рзНржпрж╛ржЩрзНржХ ржкрзЗржЬрзЗрж░ рж╕ржорж╕рзНржпрж╛ рж╕ржорж╛ржзрж╛ржирзЗрж░ ржЬржирзНржп `--base-href` ржпрзЛржЧ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ, 
        # ржпрзЗржЦрж╛ржирзЗ 'bananaos' рж╣рж▓рзЛ ржЖржкржирж╛рж░ рж░рж┐ржкрзЛржЬрж┐ржЯрж░рж┐рж░ ржирж╛ржоред
        run: npm run build -- --configuration=production --base-href /bananaos/
        env:
          NODE_ENV: production
          
      - name: ЁЯзк Run Tests (Placeholder)
        # ржЯрзЗрж╕рзНржЯрж┐ржВ рж╕рзНржХрзНрж░рж┐ржкрзНржЯ ржерж╛ржХрж▓рзЗ ржПржЦрж╛ржирзЗ 'npm run test' ржХржорж╛ржирзНржбржЯрж┐ ржпрзЛржЧ ржХрж░рждрзЗ ржкрж╛рж░рзЗржиред
        run: echo "Skipping tests for now. Add 'npm run test' here if applicable."

      - name: ЁЯЪА Deploy to GitHub Pages
        # ржмрж┐рж▓рзНржб ржХрж░рж╛ ржлрж╛ржЗрж▓ржЧрзБрж▓рж┐ GitHub Pages-ржП ржбрж┐ржкрзНрж▓ржпрж╝ ржХрж░рж╛ред
        # ржПржЯрж┐ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░ржмрзЗ ржпрзЗ рж╢рзБржзрзБржорж╛рждрзНрж░ main ржмрзНрж░рж╛ржЮрзНржЪрзЗржЗ ржбрж┐ржкрзНрж▓ржпрж╝ рж╣ржЪрзНржЫрзЗред
        uses: peaceiris/actions-gh-pages@v4
        if: github.ref == 'refs/heads/main'
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          # ржЖржкржирж╛рж░ angular.json ржЕржирзБржпрж╛ржпрж╝рзА ржЖржЙржЯржкрзБржЯ ржкрж╛рже dist/browser ржПрж░ ржирж┐ржЪрзЗред
          publish_dir: ./dist/app/browser
