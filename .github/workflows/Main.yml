name: CI/CD Pipeline for Banana OS (Angular)

# ржХржЦржи ржПржЗ Workflow ржЯрж┐ ржЯрзНрж░рж┐ржЧрж╛рж░ рж╣ржмрзЗ
on:
  # ржпржЦржи main ржмрзНрж░рж╛ржЮрзНржЪрзЗ ржХрзЛржб push ржХрж░рж╛ рж╣ржмрзЗ
  push:
    branches:
      - main
  # ржорзНржпрж╛ржирзБржпрж╝рж╛рж▓рж┐ Workflow ржЪрж╛рж▓рж╛ржирзЛрж░ ржЕржкрж╢ржи
  workflow_dispatch:

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      - name: ЁЯНМ Checkout Code
        uses: actions/checkout@v4
        
      - name: ЁЯЯв Setup Node.js
        # Node.js ржнрж╛рж░рзНрж╕ржи 20 ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ рж╣ржЪрзНржЫрзЗ
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: ЁЯУж Install Dependencies
        run: npm install

      - name: ЁЯПЧя╕П Build Project (Including Base Path Fix)
        # 1. 'ng build' ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ
        # 2. ржмрзНрж▓рзНржпрж╛ржЩрзНржХ ржкрзЗржЬрзЗрж░ рж╕ржорж╕рзНржпрж╛ рж╕ржорж╛ржзрж╛ржирзЗрж░ ржЬржирзНржп --base-href /bananaos/ ржпрзЛржЧ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗред
        run: npm run build -- --configuration=production --base-href /bananaos/
        env:
          NODE_ENV: production
          
      - name: ЁЯзк Run Tests (Placeholder)
        # ржЖржкржирж╛рж░ ржкрзНрж░ржпрж╝рзЛржЬржи рж╣рж▓рзЗ ржПржЦрж╛ржирзЗ npm run test ржпрзЛржЧ ржХрж░рждрзЗ ржкрж╛рж░рзЗржиред
        run: echo "Tests skipped. Implement 'npm run test' here if applicable."

      - name: ЁЯЪА Deploy to GitHub Pages
        # ржмрж┐рж▓рзНржб ржХрж░рж╛ ржлрж╛ржЗрж▓ржЧрзБрж▓рж┐ 'gh-pages' ржмрзНрж░рж╛ржЮрзНржЪрзЗ ржкрзБрж╢ ржХрж░рж╛ рж╣ржмрзЗред
        uses: peaceiris/actions-gh-pages@v4
        if: github.ref == 'refs/heads/main'
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          # ржЖржкржирж╛рж░ angular.json ржЕржирзБржпрж╛ржпрж╝рзА outputPath-ржПрж░ 'base': './dist' ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗред
          # ржПржЯрж┐ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░ржмрзЗ ржпрзЗ рж╕ржорж╕рзНржд ржмрж┐рж▓рзНржб ржлрж╛ржЗрж▓ ржбрж┐ржкрзНрж▓ржпрж╝ рж╣ржЪрзНржЫрзЗред
          publish_dir: ./dist 
